SET TERM ^ ;
alter PROCEDURE USPGETONTIMEDELIVERY_song (
    IN_USERKEY Varchar(36),
    IN_RVKEYS Varchar(8000) DEFAULT NULL,
    IN_CVKEYS Varchar(8000) DEFAULT NULL,
    IN_LVKEYS Varchar(8000) DEFAULT NULL,
    IN_MOVKEYS Varchar(8000) DEFAULT NULL,
    IN_SHOWRV Char(1) DEFAULT 'F',
    IN_SHOWCV Char(1) DEFAULT 'F',
    IN_SHOWLV Char(1) DEFAULT 'F',
    IN_SHOWMOV Char(1) DEFAULT 'F',
    IN_SHOWINGRID Char(1) DEFAULT 'F',
    IN_GRIDDATASOURCE Varchar(100) DEFAULT NULL,
    IN_DATEFROM Varchar(10) DEFAULT NULL,
    IN_DATETO Varchar(10) DEFAULT NULL,
    IN_FILTERCLAUSE Varchar(8000) DEFAULT NULL )
RETURNS (
    RETMULDATASETS Char(1),
    SQL Varchar(20000) )
AS
DECLARE VARIABLE CREATEDATE VARCHAR(30);
    DECLARE VARIABLE HowManyEquipTypes INTEGER; 
    DECLARE VARIABLE DisplayColumns VARCHAR(20000);
	DECLARE VARIABLE OwnerPartSql VARCHAR(1000);
	DECLARE VARIABLE PlantPartSql VARCHAR(1000);	 
	DECLARE VARIABLE DateRangeSql VARCHAR(1000);	 
	DECLARE VARIABLE CDATE VARCHAR(30);
	DECLARE VARIABLE POS Integer;
	DECLARE VARIABLE EquipTable VARCHAR(25);
	DECLARE VARIABLE EquipType VARCHAR(25);
    DECLARE VARIABLE ShippedDate VARCHAR(25);
    DECLARE VARIABLE DueDate VARCHAR(25); 
BEGIN
	CREATEDATE = CAST (CURRENT_TIMESTAMP AS VARCHAR(30));
	RETMULDATASETS = 'T';
	
	IF (IN_DateFrom IS NOT NULL AND IN_DateFrom <> '' AND IN_DateTo IS NOT NULL AND IN_DateTo <> '') THEN
	BEGIN
		DateRangeSql = ' AND DATETESTED BETWEEN ''' || :IN_DateFrom || ''' AND ''' || :IN_DateTo || ''' ';
	END
    ELSE
    BEGIN
        DateRangeSql = '';
    END
	
	DELETE FROM TEMPKEYLIST;
	
	INSERT INTO TEMPKEYLIST
	(
		UNIQUEKEY,
		CREATEDATE
	)
	SELECT	p.UNIQUEKEY, :CREATEDATE
	FROM	USPGETKEYLISTBYFILTER(:IN_USERKEY, :IN_RVKEYS, :IN_CVKEYS, :IN_LVKEYS, :IN_MOVKEYS, :IN_SHOWRV, :IN_SHOWCV, :IN_SHOWLV, :IN_SHOWMOV, :IN_SHOWINGRID, :IN_GRIDDATASOURCE, NULL, NULL, NULL, :IN_FILTERCLAUSE) p;
	
	HowManyEquipTypes = 0;

	IF (IN_ShowRV = 'T') THEN
	BEGIN
		HowManyEquipTypes = HowManyEquipTypes + 1;
	END
	
	IF (IN_ShowCV = 'T') THEN
	BEGIN
		HowManyEquipTypes = HowManyEquipTypes + 1;
	END
	
	IF (IN_ShowLV = 'T') THEN
	BEGIN
		HowManyEquipTypes = HowManyEquipTypes + 1;
	END
	
	IF (IN_ShowMOV = 'T') THEN
	BEGIN
		HowManyEquipTypes = HowManyEquipTypes + 1;
	END
	
	
	IF (HowManyEquipTypes > 1) THEN
	BEGIN	
		IF (IN_ShowRV = 'T') THEN
		BEGIN
			Sql = 'INSERT INTO TEMPONTIMEDELIVERY
			(
				UNIQUEKEY,
				EQUIPTYPE,
				LOOPNUMBER,
				TAGNUMBER,
				SERIAL,
				UNIT,
				EQUIPLOCN,
				STATUS,  
				JOBNUMBER,
				MODELNUMBER,
				MANUFACTURER,
				RISK,
				DATETESTED,
				NEXTMAINDATE,
				NEXTTESTDATE,
				NEXTINSPDATE,
				SHIPPEDDATE,
				DATERECEIVED,
				TESTAFTERDUE,
				SHIPAFTERDUE,
				TODAYAFTERDUE,
				TESTAFTERRECD,
				SHIPAFTERRECD,
				TODAYAFTERRECD,
				CREATEDATE
			)
			SELECT	rel.UNIQUEKEY,
					''RV'' AS EQUIPTYPE,
					LOOPNUMBER,
					TAGNUMBER,
					SERIAL,
					UNIT,
					EQUIPLOCN,
					STATUS,  
					JOBNUMBER,
					MODELNUMBER,
					MANUFACTURER,
					RISK,
					DATETESTED,    
					NEXTMAINDATE,
					NEXTTESTDATE,
					NEXTINSPDATE,
					ETEXT14 AS SHIPPEDDATE,
					DATERECEIVED,
					DATEDIFF(DAY,IIF(ISDATE(NEXTINSPDATE)=1, CAST(NEXTINSPDATE AS DATE),NULL),IIF(ISDATE(DATETESTED) = 1, CAST(DATETESTED AS DATE),null)) AS TESTAFTERDUE,
					DATEDIFF(DAY,IIF(ISDATE(NEXTINSPDATE)=1, CAST(NEXTINSPDATE AS DATE),NULL),IIF(ISDATE(ETEXT14) = 1, CAST(ETEXT14 AS DATE), null)) AS SHIPAFTERDUE,
					IIF(DATEDIFF(DAY,IIF(ISDATE(NEXTINSPDATE)=1, CAST(NEXTINSPDATE AS DATE),NULL),CURRENT_DATE) < 0, 
                        DATEDIFF(DAY,IIF(ISDATE(NEXTINSPDATE)=1, CAST(NEXTINSPDATE AS DATE),NULL),CURRENT_DATE) + 1,
                        DATEDIFF(DAY,IIF(ISDATE(NEXTINSPDATE)=1, CAST(NEXTINSPDATE AS DATE),NULL),CURRENT_DATE)) AS TODAYAFTERDUE, 
					DATEDIFF(DAY,IIF(ISDATE(DATERECEIVED)=1,CAST(DATERECEIVED AS DATE),NULL),IIF(ISDATE(DATETESTED) = 1, CAST(DATETESTED AS DATE),null)) AS TESTAFTERRECD,
					DATEDIFF(DAY,IIF(ISDATE(DATERECEIVED)=1,CAST(DATERECEIVED AS DATE),NULL),IIF(ISDATE(ETEXT14) = 1, CAST(ETEXT14 AS DATE), null)) AS SHIPAFTERRECD,
					DATEDIFF(DAY,IIF(ISDATE(DATERECEIVED)=1,CAST(DATERECEIVED AS DATE),NULL),IIF(ISDATE(NEXTINSPDATE)=1, CAST(NEXTINSPDATE AS DATE),NULL)) AS TODAYAFTERRECD, ''' ||
					:CREATEDATE || '''
			FROM	RELIEFD rel
			JOIN	TEMPKEYLIST tkl ON (tkl.UNIQUEKEY = rel.UNIQUEKEY
									AND tkl.CREATEDATE = ''' || :CREATEDATE || ''')
			WHERE ISDATE(NEXTINSPDATE) = 1 ' || DateRangeSql ;

			EXECUTE STATEMENT :Sql;
		END
		
		IF (IN_ShowCV = 'T') THEN
		BEGIN
			Sql = 'INSERT INTO TEMPONTIMEDELIVERY
			(
				UNIQUEKEY,
				EQUIPTYPE,
				LOOPNUMBER,
				TAGNUMBER,
				SERIAL,
				UNIT,
				EQUIPLOCN,
				STATUS,  
				JOBNUMBER,
				MODELNUMBER,
				MANUFACTURER,
				RISK,
				DATETESTED,
				NEXTMAINDATE,
				NEXTTESTDATE,
				NEXTINSPDATE,
				SHIPPEDDATE,
				DATERECEIVED,
				TESTAFTERDUE,
				SHIPAFTERDUE,
				TODAYAFTERDUE,
				TESTAFTERRECD,
				SHIPAFTERRECD,
				TODAYAFTERRECD,
				CREATEDATE
			)
			SELECT	cv.UNIQUEKEY,
					''CV'' AS EQUIPTYPE,
					LOOPNUMBER,
					TAGNUMBER,
					SERIAL,
					UNIT,
					EQUIPLOCN,
					STATUS,  
					JOBNUMBER,
					MODELNUMBER,
					MANUFACTURER,
					RISK,
					DATETESTED,    
					NEXTMAINDATE,
					NEXTTESTDATE,
					NEXTINSPDATE,
					SHIPPEDDATE,
					DATERECEIVED,
					DATEDIFF(DAY,IIF(ISDATE(NEXTINSPDATE)=1, CAST(NEXTINSPDATE AS DATE),NULL),IIF(ISDATE(DATETESTED) = 1, CAST(DATETESTED AS DATE),null)) AS TESTAFTERDUE,
					DATEDIFF(DAY,IIF(ISDATE(NEXTINSPDATE)=1, CAST(NEXTINSPDATE AS DATE),NULL),IIF(ISDATE(SHIPPEDDATE) = 1, CAST(SHIPPEDDATE AS DATE), null)) AS SHIPAFTERDUE,
					IIF(DATEDIFF(DAY,IIF(ISDATE(NEXTINSPDATE)=1, CAST(NEXTINSPDATE AS DATE),NULL),CURRENT_DATE) < 0, 
                        DATEDIFF(DAY,IIF(ISDATE(NEXTINSPDATE)=1, CAST(NEXTINSPDATE AS DATE),NULL),CURRENT_DATE) + 1,
                        DATEDIFF(DAY,IIF(ISDATE(NEXTINSPDATE)=1, CAST(NEXTINSPDATE AS DATE),NULL),CURRENT_DATE)) AS TODAYAFTERDUE, 
					DATEDIFF(DAY,IIF(ISDATE(DATERECEIVED)=1,CAST(DATERECEIVED AS DATE),NULL),IIF(ISDATE(DATETESTED) = 1, CAST(DATETESTED AS DATE),null)) AS TESTAFTERRECD,
					DATEDIFF(DAY,IIF(ISDATE(DATERECEIVED)=1,CAST(DATERECEIVED AS DATE),NULL),IIF(ISDATE(SHIPPEDDATE) = 1, CAST(SHIPPEDDATE AS DATE), null)) AS SHIPAFTERRECD,
					DATEDIFF(DAY,IIF(ISDATE(DATERECEIVED)=1,CAST(DATERECEIVED AS DATE),NULL),IIF(ISDATE(NEXTINSPDATE)=1, CAST(NEXTINSPDATE AS DATE),NULL)) AS TODAYAFTERRECD, ''' ||
					:CREATEDATE || '''
			FROM	CV cv
			JOIN	TEMPKEYLIST tkl ON (tkl.UNIQUEKEY = cv.UNIQUEKEY
									AND tkl.CREATEDATE = ''' || :CREATEDATE || ''')
			WHERE ISDATE(NEXTINSPDATE) = 1 ' || DateRangeSql ;

			EXECUTE STATEMENT :Sql;
		END
		
		IF (IN_ShowLV = 'T') THEN
		BEGIN
			Sql = 'INSERT INTO TEMPONTIMEDELIVERY
			(
				UNIQUEKEY,
				EQUIPTYPE,
				LOOPNUMBER,
				TAGNUMBER,
				SERIAL,
				UNIT,
				EQUIPLOCN,
				STATUS,  
				JOBNUMBER,
				MODELNUMBER,
				MANUFACTURER,
				RISK,
				DATETESTED,
				NEXTMAINDATE,
				NEXTTESTDATE,
				NEXTINSPDATE,
				SHIPPEDDATE,
				DATERECEIVED,
				TESTAFTERDUE,
				SHIPAFTERDUE,
				TODAYAFTERDUE,
				TESTAFTERRECD,
				SHIPAFTERRECD,
				TODAYAFTERRECD,
				CREATEDATE
			)
			SELECT	lv.UNIQUEKEY,
					''LV'' AS EQUIPTYPE,
					LOOPNUMBER,
					TAGNUMBER,
					SERIAL,
					UNIT,
					EQUIPLOCN,
					STATUS,  
					JOBNUMBER,
					MODELNUMBER,
					MANUFACTURER,
					RISK,
					DATETESTED,    
					NEXTMAINDATE,
					NEXTTESTDATE,
					DATEDUE,
					SHIPPEDDATE,
					DATERECEIVED,
					DATEDIFF(DAY,IIF(ISDATE(DATEDUE)=1, CAST(DATEDUE AS DATE),NULL),IIF(ISDATE(DATETESTED) = 1, CAST(DATETESTED AS DATE),null)) AS TESTAFTERDUE,
					DATEDIFF(DAY,IIF(ISDATE(DATEDUE)=1, CAST(DATEDUE AS DATE),NULL),IIF(ISDATE(SHIPPEDDATE) = 1, CAST(SHIPPEDDATE AS DATE), null)) AS SHIPAFTERDUE,
					IIF(DATEDIFF(DAY,IIF(ISDATE(NEXTINSPDATE)=1, CAST(NEXTINSPDATE AS DATE),NULL),CURRENT_DATE) < 0, 
                        DATEDIFF(DAY,IIF(ISDATE(NEXTINSPDATE)=1, CAST(NEXTINSPDATE AS DATE),NULL),CURRENT_DATE) + 1,
                        DATEDIFF(DAY,IIF(ISDATE(NEXTINSPDATE)=1, CAST(NEXTINSPDATE AS DATE),NULL),CURRENT_DATE)) AS TODAYAFTERDUE, 
					DATEDIFF(DAY,IIF(ISDATE(DATERECEIVED)=1,CAST(DATERECEIVED AS DATE),NULL),IIF(ISDATE(DATETESTED) = 1, CAST(DATETESTED AS DATE),null)) AS TESTAFTERRECD,
					DATEDIFF(DAY,IIF(ISDATE(DATERECEIVED)=1,CAST(DATERECEIVED AS DATE),NULL),IIF(ISDATE(SHIPPEDDATE) = 1, CAST(SHIPPEDDATE AS DATE), null)) AS SHIPAFTERRECD,
					DATEDIFF(DAY,IIF(ISDATE(DATERECEIVED)=1,CAST(DATERECEIVED AS DATE),NULL),IIF(ISDATE(DATEDUE)=1, CAST(DATEDUE AS DATE),NULL)) AS TODAYAFTERRECD, ''' ||
					:CREATEDATE || '''
			FROM	LINEV lv
			JOIN	TEMPKEYLIST tkl ON (tkl.UNIQUEKEY = lv.UNIQUEKEY
									AND tkl.CREATEDATE = ''' || :CREATEDATE || ''')
			WHERE ISDATE(DATEDUE) = 1 ' || DateRangeSql ;

			EXECUTE STATEMENT :Sql;
		END
		
		IF (IN_ShowMOV = 'T') THEN
		BEGIN
			Sql = 'INSERT INTO TEMPONTIMEDELIVERY
			(
				UNIQUEKEY,
				EQUIPTYPE,
				LOOPNUMBER,
				TAGNUMBER,
				SERIAL,
				UNIT,
				EQUIPLOCN,
				STATUS,  
				JOBNUMBER,
				MODELNUMBER,
				MANUFACTURER,
				RISK,
				DATETESTED,
				NEXTMAINDATE,
				NEXTTESTDATE,
				NEXTINSPDATE,
				SHIPPEDDATE,
				DATERECEIVED,
				TESTAFTERDUE,
				SHIPAFTERDUE,
				TODAYAFTERDUE,
				TESTAFTERRECD,
				SHIPAFTERRECD,
				TODAYAFTERRECD,
				CREATEDATE
			)
			SELECT	mov.UNIQUEKEY,
					''MOV'' AS EQUIPTYPE,
					LOOPNUMBER,
					TAGNUMBER,
					SERIAL,
					UNIT,
					EQUIPLOCN,
					STATUS,  
					JOBNUMBER,
					MODELNUMBER,
					MANUFACTURER,
					RISK,
					DATETESTED,    
					NEXTMAINDATE,
					NEXTTESTDATE,
					DATEDUE,
					SHIPPEDDATE,
					DATERECEIVED,
					IIF( ISDATE(DATETESTED) = 1, DATEDIFF(DAY,CAST(DATEDUE AS DATE),CAST(DATETESTED AS DATE)), null) AS TESTAFTERDUE,
					IIF( ISDATE(SHIPPEDDATE) = 1, DATEDIFF(DAY,CAST(DATEDUE AS DATE),CAST(SHIPPEDDATE AS DATE)), null) AS SHIPAFTERDUE,
					IIF(DATEDIFF(DAY,CAST(NEXTINSPDATE AS DATE),CURRENT_DATE) < 0, DATEDIFF(DAY,CAST(NEXTINSPDATE AS DATE),CURRENT_DATE) + 1,DATEDIFF(DAY,CAST(NEXTINSPDATE AS DATE),CURRENT_DATE)) AS TODAYAFTERDUE,
					IIF( ISDATE(DATERECEIVED) = 1 AND ISDATE(DATETESTED) = 1, DATEDIFF(DAY,CAST(DATERECEIVED AS DATE),CAST(DATETESTED AS DATE)), null) AS TESTAFTERRECD,
					IIF( ISDATE(DATERECEIVED) = 1 AND ISDATE(SHIPPEDDATE) = 1, DATEDIFF(DAY,CAST(DATERECEIVED AS DATE),CAST(SHIPPEDDATE AS DATE)), null) AS SHIPAFTERRECD,
					IIF( ISDATE(DATERECEIVED) = 1, DATEDIFF(DAY,CAST(DATERECEIVED AS DATE),CAST(DATEDUE AS DATE)), null) AS TODAYAFTERRECD,''' ||
					:CREATEDATE || '''
			FROM	MOV mov
			JOIN	TEMPKEYLIST tkl ON (tkl.UNIQUEKEY = mov.UNIQUEKEY
									AND tkl.CREATEDATE = ''' || :CREATEDATE || ''')
			WHERE ISDATE(DATEDUE) = 1 ' || DateRangeSql ;

			EXECUTE STATEMENT :Sql;
		END
		
		SQL = ' SELECT	UNIQUEKEY,
				EQUIPTYPE,
				LOOPNUMBER,
				TAGNUMBER,
				SERIAL,
				UNIT,
				EQUIPLOCN,
				STATUS,  
				JOBNUMBER,
				MODELNUMBER,
				MANUFACTURER,
				RISK,
				DATETESTED,
				NEXTMAINDATE,
				NEXTTESTDATE,
				NEXTINSPDATE,
				SHIPPEDDATE,
				DATERECEIVED,
				TESTAFTERDUE,
				SHIPAFTERDUE,
				TODAYAFTERDUE,
				TESTAFTERRECD,
				SHIPAFTERRECD,
				TODAYAFTERRECD
		FROM	TEMPONTIMEDELIVERY
		WHERE	CREATEDATE = ''' || :CREATEDATE || '''';
		
	END
	ELSE
	BEGIN
		EXECUTE PROCEDURE uspPrepareGridFieldsNoCountCust(IN_UserKey, '', IN_GridDataSource) RETURNING_VALUES(CDATE);
	
		SELECT	LIST(FIELDNAME, ',a.')
		FROM	TEMPGRIDFIELD t
		WHERE DATATABLE <> 'GRIDCUSTOMIZEDFIELD' AND CREATEDATE  = :CDATE AND NOT EXISTS (SELECT FIELDNAME FROM GRIDDEFAULTFIELD WHERE GRIDDATASOURCE = 'uspGetOnTimeDelivery' AND QUERYTYPE = 'SELECT' AND FIELDNAME = t. FIELDNAME ) 
		INTO	:DisplayColumns;
		
		DisplayColumns = 'a.' || DisplayColumns;
		
		OwnerPartSql = '';
		PlantPartSql = '';
		
		DisplayColumns = REPLACE(DisplayColumns, 'a.OWNERNAME', 'OWNERNAME');
		DisplayColumns = REPLACE(DisplayColumns, 'a.LOCATION', 'LOCATION');
		DisplayColumns = REPLACE(DisplayColumns, 'a.AREA', 'AREA');
		DisplayColumns = REPLACE(DisplayColumns, 'a.CALCULATEDDATE', 'CALCULATEDDATE');        
        select p.ResultColumns from uspAppendCalculationField(:DisplayColumns,:IN_UserKey,:IN_GridDataSource) p into :DisplayColumns;
        
		POS = 0;
		POS = POSITION('LOOPNUMBER' IN :DisplayColumns);
			
		IF(POS=0) THEN
		BEGIN
			DisplayColumns = DisplayColumns || ',a.LOOPNUMBER';
		END
				
		POS = 0;  		
		POS = POSITION('OWNERNAME' IN :DisplayColumns);
		
		IF(POS>0) THEN
		BEGIN
			OwnerPartSql = ' LEFT JOIN OWNERS own ON own.UNIQUEKEY = a.OWNERKEY ';
		END
		
		POS = 0;
		POS = POSITION('LOCATION' IN :DisplayColumns);
		
		IF(POS=0) THEN
		BEGIN
			POS = POSITION('AREA' IN :DisplayColumns);
		END
		
		IF(POS>0) THEN
		BEGIN
			PlantPartSql = ' LEFT JOIN PLANTS pla ON pla.UNIQUEKEY = a.PLANTKEY  ';
		END
		
		ShippedDate = 'SHIPPEDDATE';
		DueDate = 'DATEDUE';           
		
	    IF (IN_ShowRV = 'T') THEN
        BEGIN
            EquipTable = 'ReliefD';
            EquipType = 'RV';
            ShippedDate = 'ETEXT14';
            DueDate = 'NEXTINSPDATE';
        END
        ELSE IF (IN_ShowCV = 'T') THEN
        BEGIN
            EquipTable = 'CV';
            EquipType = 'CV';
            DueDate = 'NEXTINSPDATE';
        END	
        ELSE IF (IN_ShowMOV = 'T') THEN
        BEGIN
            EquipTable = 'MOV';
            EquipType = 'MOV';
        END
        ELSE IF (IN_ShowLV = 'T') THEN
        BEGIN
            EquipTable = 'LineV';
            EquipType = 'LV';
        END
        
		SQL = '	SELECT  a.UNIQUEKEY, '
								 || DisplayColumns || 
					', ''' || EquipType || ''' AS EQUIPTYPE,  		 
						DATETESTED,    
						' || DueDate || ' AS NEXTINSPDATE,
						' || ShippedDate || ' AS SHIPPEDDATE,
						DATERECEIVED,
						IIF( ISDATE(DATETESTED) = 1, DATEDIFF(DAY,CAST(' || DueDate || '  AS DATE),CAST(DATETESTED AS DATE)), null) AS TESTAFTERDUE,
						IIF( ISDATE(' || ShippedDate || ' ) = 1, DATEDIFF(DAY,CAST(' || DueDate || '  AS DATE),CAST(' || ShippedDate || '  AS DATE)), null) AS SHIPAFTERDUE,
						IIF(DATEDIFF(DAY,CAST(' || DueDate || ' AS DATE),CURRENT_DATE) < 0, DATEDIFF(DAY,CAST(' || DueDate || ' AS DATE),CURRENT_DATE) + 1,DATEDIFF(DAY,CAST(' || DueDate || ' AS DATE),CURRENT_DATE)) AS TODAYAFTERDUE,
						IIF( ISDATE(DATERECEIVED) = 1 AND ISDATE(DATETESTED) = 1, DATEDIFF(DAY,CAST(DATERECEIVED AS DATE),CAST(DATETESTED AS DATE)), null) AS TESTAFTERRECD,
						IIF( ISDATE(DATERECEIVED) = 1 AND ISDATE(' || ShippedDate || ' ) = 1, DATEDIFF(DAY,CAST(DATERECEIVED AS DATE),CAST(' || ShippedDate || '  AS DATE)), null) AS SHIPAFTERRECD,
						IIF( ISDATE(DATERECEIVED) = 1, DATEDIFF(DAY,CAST(DATERECEIVED AS DATE),CAST(' || DueDate || '  AS DATE)), null) AS TODAYAFTERRECD
						FROM    ' || EquipTable || ' a
						JOIN	TEMPKEYLIST b ON (b.UNIQUEKEY = a.UNIQUEKEY AND CREATEDATE = ''' || CREATEDATE || ''')
						' || OwnerPartSql || PlantPartSql || ' WHERE ISDATE(' || DueDate || ' ) = 1 ' || DateRangeSql ;
						
	END	
		
	SUSPEND;
END^
SET TERM ; ^


GRANT EXECUTE
 ON PROCEDURE USPGETONTIMEDELIVERY TO  SYSDBA;

